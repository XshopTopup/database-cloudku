<nav class="w-full bg-[#0B1120] px-4 py-4 flex justify-between items-center border-b border-white/5 sticky top-0 z-50">
    <div class="flex items-center gap-2">
        <div class="bg-[#14B8A6] p-1.5 rounded-lg">
            <i class="fas fa-cloud text-white text-sm"></i>
        </div>
        <span class="text-white font-bold text-lg tracking-tight">Cloud<span class="text-[#14B8A6]">Ku</span><span class="text-[10px] font-medium text-slate-500 ml-2 uppercase tracking-widest">Dashboard</span></span>
    </div>
    <div class="flex items-center gap-4">
        <a href="#docs" class="text-[11px] font-bold text-slate-400 hover:text-white uppercase tracking-wider">API Docs</a>
        <button onclick="logout()" class="text-[11px] font-bold text-red-400 hover:text-red-300 uppercase tracking-wider">Logout</button>
        <div class="flex items-center gap-2 bg-[#1E293B] pl-3 pr-1 py-1 rounded-full border border-white/10">
            <span class="text-xs font-semibold text-[#14B8A6]" id="displayUsername">User</span>
            <div class="w-7 h-7 bg-[#14B8A6]/20 rounded-full flex items-center justify-center">
                <i class="fas fa-user text-[#14B8A6] text-[10px]"></i>
            </div>
        </div>
    </div>
</nav>

<main class="max-w-xl mx-auto px-4 py-8 space-y-6">
    
    <div class="bg-[#111827] rounded-[2rem] p-8 border border-white/5 shadow-2xl">
        <div class="flex items-center gap-3 mb-6">
            <i class="fas fa-key text-[#14B8A6] text-sm"></i>
            <h3 class="text-white font-bold text-sm tracking-tight uppercase">API Key Access</h3>
        </div>
        <div class="relative bg-[#070B14] rounded-2xl p-5 border border-white/5">
            <input type="password" id="apiKeyInput" value="" readonly 
                class="w-full bg-transparent text-[#14B8A6] font-mono text-sm focus:outline-none pr-20">
            <div class="absolute right-4 top-1/2 -translate-y-1/2 flex gap-3">
                <button onclick="toggleKey()" class="text-slate-500 hover:text-white transition"><i class="fas fa-eye text-sm"></i></button>
                <button onclick="copyKey()" class="text-slate-500 hover:text-white transition"><i class="fas fa-copy text-sm"></i></button>
            </div>
        </div>
    </div>

    <div class="bg-[#111827] rounded-[2rem] p-8 border border-white/5 shadow-2xl">
        <h3 class="text-slate-400 font-bold text-[10px] uppercase tracking-[0.2em] mb-6">New Database</h3>
        <div class="space-y-4">
            <input type="text" id="newFolderName" placeholder="Database Name..." 
                class="w-full bg-[#1E293B]/40 border border-white/10 p-5 rounded-2xl outline-none focus:border-[#14B8A6] transition text-sm text-white placeholder:text-slate-600">
            <button onclick="initFolder()" id="btnInit" class="w-full bg-[#14B8A6] hover:bg-[#0D9488] text-[#0B1120] font-black py-5 rounded-2xl transition-all uppercase text-[11px] tracking-[0.15em] shadow-lg shadow-[#14B8A6]/10">
                Create Database
            </button>
        </div>
    </div>

    <div class="bg-[#111827] rounded-[2rem] p-8 border border-white/5 shadow-2xl min-h-[400px]">
        <div class="flex justify-between items-center mb-10">
            <h2 class="text-2xl font-bold text-white tracking-tight">My Cloud Databases</h2>
            <button onclick="loadRepos()" class="text-slate-500 hover:text-[#14B8A6] transition">
                <i class="fas fa-sync-alt text-lg" id="refreshIcon"></i>
            </button>
        </div>
        <div id="repoList" class="space-y-4">
            <div class="flex flex-col items-center justify-center py-20 opacity-40">
                <div class="w-16 h-16 bg-white/5 rounded-2xl flex items-center justify-center mb-4">
                    <i class="fas fa-plus text-slate-400 text-xl"></i>
                </div>
                <p class="text-[10px] font-bold uppercase tracking-[0.3em] text-slate-500">No Database Found</p>
            </div>
        </div>
    </div>

    <section id="docs" class="pt-10 space-y-8">
        <h2 class="text-white font-bold text-lg flex items-center gap-3 px-2">
            <i class="fas fa-book text-[#14B8A6]"></i> Documentation
        </h2>

        <div class="bg-[#111827] rounded-[2rem] p-8 border border-white/5 shadow-2xl">
            <div class="flex items-center gap-3 mb-6">
                <span class="bg-[#14B8A6] text-[#0B1120] text-[10px] font-black px-2 py-1 rounded">POST</span>
                <h3 class="text-white font-bold text-sm tracking-tight">/api/folder</h3>
            </div>
            <p class="text-xs text-slate-400 mb-6">Membuat folder baru yang berfungsi sebagai repositori mandiri milik user.</p>
            <div class="space-y-4">
                <p class="text-[10px] font-bold text-[#14B8A6] uppercase tracking-widest">Request Body:</p>
                <div class="bg-[#070B14] p-5 rounded-2xl border border-white/5 font-mono text-[11px] text-white/70">
                    {"folderName": "Backup123"}
                </div>
            </div>
        </div>

        <div class="bg-[#111827] rounded-[2rem] p-8 border border-white/5 shadow-2xl">
            <div class="flex items-center gap-3 mb-6">
                <span class="bg-[#14B8A6] text-[#0B1120] text-[10px] font-black px-2 py-1 rounded">POST</span>
                <h3 class="text-white font-bold text-sm tracking-tight">/api/db/save</h3>
            </div>
            <p class="text-xs text-slate-400 mb-6">Menyimpan atau memperbarui data JSON ke repositori publik bersama.</p>
            <div class="space-y-6">
                <div>
                    <p class="text-[10px] font-bold text-[#14B8A6] uppercase tracking-widest mb-3">Request Body:</p>
                    <div class="bg-[#070B14] p-5 rounded-2xl border border-white/5 font-mono text-[11px] text-white/70">
                        {"dbName": "config", "fileName": "data.json", "content": "..."}
                    </div>
                </div>
                <div>
                    <p class="text-[10px] font-bold text-[#14B8A6] uppercase tracking-widest mb-3">Access URL:</p>
                    <div class="bg-[#070B14] p-5 rounded-2xl border border-white/5 font-mono text-[11px] text-white/70 italic">
                        GET /db/{shareCode}/{fileName}
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-[#111827] rounded-[2rem] p-8 border border-white/5 shadow-2xl">
            <div class="flex items-center gap-3 mb-6">
                <span class="bg-[#14B8A6] text-[#0B1120] text-[10px] font-black px-2 py-1 rounded">POST</span>
                <h3 class="text-white font-bold text-sm tracking-tight">/api/backup/upload</h3>
            </div>
            <p class="text-xs text-slate-400 mb-6">Upload file ke repositori mandiri yang sudah dibuat melalui endpoint /api/folder.</p>
            <div class="space-y-6">
                <div>
                    <p class="text-[10px] font-bold text-[#14B8A6] uppercase tracking-widest mb-3">Request Body:</p>
                    <div class="bg-[#070B14] p-5 rounded-2xl border border-white/5 font-mono text-[11px] text-white/70">
                        {"folderName": "Backup123", "fileName": "v1.zip", "content": "..."}
                    </div>
                </div>
                <div>
                    <p class="text-[10px] font-bold text-[#14B8A6] uppercase tracking-widest mb-3">Access URL:</p>
                    <div class="bg-[#070B14] p-5 rounded-2xl border border-white/5 font-mono text-[11px] text-white/70 italic">
                        GET /s/{shareCode}/{fileName}
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<script>
    const apiKey = localStorage.getItem('apiKey');
    const username = localStorage.getItem('username') || 'User';

    if (!apiKey) window.location.href = '/login';
    document.getElementById('displayUsername').innerText = username;
    document.getElementById('apiKeyInput').value = apiKey;

    function logout() { localStorage.clear(); window.location.href = '/login'; }
    function toggleKey() { const i = document.getElementById('apiKeyInput'); i.type = i.type === 'password' ? 'text' : 'password'; }
    function copyKey() { navigator.clipboard.writeText(document.getElementById('apiKeyInput').value); alert('Copied!'); }

    async function loadRepos() {
        const listContainer = document.getElementById('repoList');
        const icon = document.getElementById('refreshIcon');
        icon.classList.add('animate-spin');
        try {
            const res = await fetch('/api/my-folders', { headers: { 'x-api-key': apiKey } });
            const data = await res.json();
            if (!data.folders || data.folders.length === 0) {
                listContainer.innerHTML = `<div class="flex flex-col items-center justify-center py-20 opacity-40"><div class="w-16 h-16 bg-white/5 rounded-2xl flex items-center justify-center mb-4"><i class="fas fa-plus text-slate-400 text-xl"></i></div><p class="text-[10px] font-bold uppercase tracking-[0.3em] text-slate-500">No Database Found</p></div>`;
                return;
            }
            listContainer.innerHTML = data.folders.map(f => `
                <div class="flex items-center justify-between p-6 bg-[#070B14] border border-white/5 rounded-2xl hover:border-[#14B8A6]/30 transition-all group">
                    <div class="flex items-center gap-4">
                        <div class="bg-[#14B8A6]/10 p-4 rounded-xl text-[#14B8A6]"><i class="fas fa-folder"></i></div>
                        <div>
                            <h4 class="text-white font-bold text-sm tracking-tight">${f.folderName}</h4>
                            <p class="text-[9px] text-slate-500 font-mono uppercase tracking-widest mt-1">${f.repoName}</p>
                        </div>
                    </div>
                    <button onclick="copyShareLink('${f.shareCode}', '${f.dbPath ? 'db' : 's'}')" class="text-slate-500 group-hover:text-[#14B8A6] transition">
                        <i class="fas fa-link"></i>
                    </button>
                </div>
            `).join('');
        } finally { setTimeout(() => icon.classList.remove('animate-spin'), 500); }
    }

    async function initFolder() {
        const name = document.getElementById('newFolderName').value;
        const btn = document.getElementById('btnInit');
        if(!name) return;
        btn.disabled = true; btn.innerText = 'WAIT...';
        try {
            const res = await fetch('/api/folder', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'x-api-key': apiKey },
                body: JSON.stringify({ folderName: name })
            });
            if(res.ok) { document.getElementById('newFolderName').value = ''; loadRepos(); }
            else { const d = await res.json(); alert(d.error); }
        } finally { btn.disabled = false; btn.innerText = 'CREATE DATABASE'; }
    }

    function copyShareLink(code, type) {
        const url = window.location.origin + '/' + type + '/' + code + '/file.json';
        navigator.clipboard.writeText(url);
        alert('URL Copied!');
    }

    loadRepos();
</script>
